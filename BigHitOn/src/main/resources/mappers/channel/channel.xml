<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bighit.on.channel">
	<select id="getNowKey" resultType="string">
		SELECT serial_key
				FROM channelserial
				WHERE is_used = 0
				AND ROWNUM = 1
	</select>
	<!-- 목록조회 -->
	<!-- com.bighit.on.workspace.doSelectList -->
	<select id="doSelectList" parameterType="ChannelVO" resultType="ChannelVO">
		SELECT             
		    ch_link AS chLink,       
		    ws_link AS wsLink,       
		    ch_name AS chName,       
		    topic,         
		    ch_description AS chDescription,
		    ch_access AS chAccess,     
		    reg_id AS regId,        
		    reg_dt AS regDt        
		FROM channels      
		WHERE ws_link = #{wsLink}  		
	</select>
	
	<!-- 단건조회 -->
	<!-- com.bighit.on.workspace.doDelete -->
	<select id="doSelectOne" parameterType="ChannelVO" resultType="ChannelVO">
		SELECT             
		    ch_link AS chLink,       
		    ws_link AS wsLink,       
		    ch_name AS chName,       
		    topic,         
		    ch_description AS chDescription,
		    ch_access AS chAccess,     
		    reg_id AS regId,        
		    reg_dt AS regDt        
		FROM channels      
		WHERE ch_link = #{chLink}  
	</select>
	
	<!-- 삭제 -->
	<!-- com.bighit.on.workspace.doDelete -->
	<delete id="doDelete" parameterType="ChannelVO">
		<![CDATA[
		DELETE FROM channels
		WHERE ch_link = #{chLink}  
		]]>  		
	</delete>
	
	<!-- 등록 -->
	<!-- com.bighit.on.workspace.doInsert -->
	<insert id="doInsert" parameterType="ChannelVO">
		  INSERT INTO channels (	 
		 	 ch_link, 
		 	 ws_link,         
		     ch_name,          
		     topic,            
		     ch_description,   
		     ch_access,        
		     reg_id,           
		     reg_dt            
		 ) VALUES ( 
		     (	SELECT serial_key
				FROM channelserial
				WHERE is_used = 0
				AND ROWNUM = 1),		                     
		     #{wsLink},                
		     #{chName},                
		     #{topic},                
		     #{chDescription},                
		     #{chAccess},                
		     #{regId},                
		     SYSDATE           
		 )                     		
	</insert>
	<update id="updateKey">
	UPDATE channelserial
	SET
	    is_used = 1
	WHERE
	    is_used = 0
	    AND ROWNUM = 1
	</update>

</mapper>